# Backend Build Tracker (Demo, No Auth)

**Purpose**: Track the backend build phases toward the original AI trading flow goal.  
**Scope**: Backend only, demo mode (auth excluded).

**Source of truth**: Phase 0+ / phase-overview docs define the detailed specs and acceptance criteria.  
This tracker is a lightweight status mirror and should not override phase docs.

---

## Phase 0 ‚Äî Baseline Wiring

**Status**: ‚úÖ Complete

- [x] Define execution step schema and enforce consistent step updates
  - Added `StepName` enum: `data_fetch`, `market_analysis`, `risk_validation`, `decision`
  - Added `create_standard_steps()` factory
  - Fixed `execute_flow` to use correct step indices
- [x] Wire scheduled flow triggers (cron/beat ‚Üí `/flows/{id}/trigger`)
  - Created `app/tasks/flow_tasks.py`
  - Added `trigger_scheduled_flows_task` to celery beat (every minute)
  - Uses `croniter` to evaluate flow schedules
- [x] Add execution status transitions (pending ‚Üí running ‚Üí completed/failed)
  - Each step now has proper start/complete timestamps
  - Failed steps are marked with error message

---

## Phase 1 ‚Äî Market + Signal Sources (Pre-Trade Gate)

**Status**: ‚úÖ Complete

- [x] Market data service (OHLCV + realtime price) ‚Äî existing Binance client
- [x] X/Twitter search integration (BTC terms ‚Üí sentiment)
  - Created `app/integrations/sentiment/twitter_client.py`
  - Uses Twitter API v2 for recent tweet search
  - Keyword-based sentiment analysis
- [x] Reddit search integration (BTC subreddits ‚Üí sentiment)
  - Created `app/integrations/sentiment/reddit_client.py`
  - Searches crypto subreddits (Bitcoin, CryptoCurrency, etc.)
  - OAuth2 authentication
- [x] Polymarket odds integration (BTC markets ‚Üí signal)
  - Created `app/integrations/sentiment/polymarket_client.py`
  - Public API, no key required
  - Analyzes price prediction market odds
- [x] Signal aggregator ‚Üí normalized `signal_score`
  - Created `app/services/signal_aggregator.py`
  - Combines all sources with weighted average
  - Outputs `AggregatedSignal` with score, confidence, classification
- [x] Wire aggregated signals into flow execution context
  - `execute_flow` now fetches and attaches signal data for AI agents

---

## Phase 2 ‚Äî AI Pre-Trade Flow

**Status**: ‚úÖ Complete

- [x] Pre-trade evaluator gate (market + sentiment + indicators)
- [x] Entry gate (skip risk step when confidence/signal criteria fail)
- [x] Decision logging (model, tokens, cost, reasoning)

---

## Phase 3 ‚Äî Risk Rules Engine

**Status**: ‚úÖ Complete

- [x] Risk rules schema + persistence (risk_rules collection + CRUD)
- [x] Validate proposed trade against limits (flow config + portfolio state)
- [x] Hard-limit gate added before AI risk manager (config or risk_rules)
- [x] Wire risk manager input to real limits + portfolio state

---

## Phase 4 ‚Äî Exchange Execution

**Status**: üöß In progress

- [x] Decrypt credentials and build exchange client
- [x] Place order on exchange
- [x] Cancel order on exchange
- [x] Retry + failure handling

---

## Phase 5 ‚Äî Position Lifecycle Automation

**Status**: ‚è≥ Not started

- [ ] Create position on fill
- [ ] Monitoring loop (worker) + price refresh
- [ ] Exit conditions (SL/TP/AI signal/margin)
- [ ] Forced close path

---

## Phase 6 ‚Äî Transactions + Wallet State

**Status**: ‚è≥ Not started

- [ ] Transaction ledger (entry/exit)
- [ ] Wallet state updates (PnL, exposure, utilization)
- [ ] Execution ‚Üí position ‚Üí transaction traceability

---

## Phase 7 ‚Äî Safeguards + Ops

**Status**: ‚è≥ Not started

- [ ] Circuit breakers / kill switch
- [ ] Rate limiting + error middleware
- [ ] Metrics + structured logs for executions

---

## Required Credentials

Add these to your `.env` file:

### Core (Required)
```env
# MongoDB
MONGODB_URL=mongodb://localhost:27017
MONGODB_DB_NAME=moniqo_demo

# Redis (also used for Celery)
REDIS_URL=redis://localhost:6379/0

# JWT (generate a random key)
JWT_SECRET_KEY=your-secret-key

# Encryption (generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())")
ENCRYPTION_KEY=your-fernet-key
```

### AI Models (at least one required for flows)
```env
# Groq (free tier available)
GROQ_API_KEY=gsk_...

# OR Google Gemini
GEMINI_API_KEY=...

# OR OpenRouter
OPENROUTER_API_KEY=...
```

### Sentiment Sources (optional, for signal aggregation)
```env
# X/Twitter API (requires developer account)
TWITTER_BEARER_TOKEN=AAAA...

# Reddit API (create app at reddit.com/prefs/apps)
REDDIT_CLIENT_ID=...
REDDIT_CLIENT_SECRET=...

# Polymarket: No API key needed (public API)
```

### AWS S3 (for avatar uploads, can be dummy for demo)
```env
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
AWS_S3_BUCKET_NAME=...
```

### Email (can be dummy for demo)
```env
RESEND_API_KEY=...
FROM_EMAIL=noreply@example.com
SUPERADMIN_EMAIL=admin@example.com
SUPERADMIN_PASSWORD=admin123
```
